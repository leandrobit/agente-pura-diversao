# -*- coding: utf-8 -*-
"""Agente_Pura_Diversao.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1qBM4LEgiuaw1I9YjrAObve8qKqpnB8Ka
"""

# Commented out IPython magic to ensure Python compatibility.
####################################################################################################################################################
#                                                               AGENTE PURA DIVERS√ÉO                                                               #
#--------------------------------------------------------------------------------------------------------------------------------------------------#
# Este agente tem como finalidade auxiliar qualquer pessoa a encontrar
# divers√£o no final de semana atual ou no pr√≥ximo final de semana
# com base em algumas perguntas.
#--------------------------------------------------------------------------------------------------------------------------------------------------#
# Estas s√£o algumas das perguntas a serem respondidas:
# 01) Em qual cidade e estado voc√™ estar√°?
# 02) Voc√™ tem alguma prefer√™ncia de dia ou per√≠odo para essas atividades? (Ex: sexta √† noite, s√°bado durante o dia, domingo √† tarde, ou est√° totalmente livre?)
# 03) Quem vai curtir esse momento com voc√™? (Ex: vou sozinho(a), com meu amor, com a fam√≠lia e crian√ßas ‚Äì se sim, qual a faixa et√°ria delas?, com um grupo de amigos?)
# 04) Para que tipo de programa voc√™ est√° mais inclinado(a)? Pense em categorias como: Gastronomia, Cultura, Ao Ar Livre, Esportes, Vida Noturna, Bem-Estar e Relaxamento,
#     Compras ou Algo totalmente diferente ou inusitado que voc√™ sempre quis experimentar?
# 05) Qual a 'vibe' que voc√™ procura para este final de semana? Algo mais agitado e social, super tranquilo e relaxante, culturalmente enriquecedor, cheio de aventura, rom√¢ntico, ou talvez uma mistura?
# 06) Existe algum tipo de programa ou atividade que voc√™ gostaria de evitar a todo custo neste final de semana?
# 07) Falando de investimento, voc√™ tem uma faixa de or√ßamento em mente para essas atividades? (Ex: busco op√ß√µes gratuitas, algo mais em conta at√© R$ X por pessoa, posso gastar um pouco mais, ou o c√©u √© o limite?)
# 08) At√© que dist√¢ncia voc√™ toparia se deslocar a partir do seu ponto principal (casa/hotel) para encontrar a atividade ideal?
# 09) Voc√™ j√° tem alguma ideia guardada na manga, algum lugar que sempre quis conhecer ou algo que viu e ficou curioso(a)?
# 10) Lembrando de outros finais de semana, teve alguma experi√™ncia de lazer que voc√™ AMOU ou alguma que DETESTOU? Compartilhar isso me ajuda a entender ainda mais o seu perfil!

# %pip -q install google-genai

# Configura a API Key do Google Gemini

# Lib Python para acesso a recursos do sistema operacional
import os

# Lib Google Colab para acesso a dados do usu√°rio
from google.colab import userdata

# Configurando uma vari√°vel de ambiente
os.environ["GOOGLE_API_KEY"] = userdata.get('GOOGLE_API_KEY')

# Configura o cliente da SDK do Gemini

# Importando a lib Google Gemini
from google import genai

# Instanciando um client do Gemini
client = genai.Client()

# Definindo o modelo a ser utilizado
MODEL_ID = "gemini-2.0-flash"

# Instalar Framework ADK de agentes do Google ################################################
!pip install -q google-adk   # o par√¢metro -q oculta aqueles v√°rios detalhes da instala√ß√£o

from google.adk.agents import Agent
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService
from google.adk.tools import google_search  # outras tools: maps, viagens, etc...

import os
from datetime import datetime
from google.genai import types  # Para criar conte√∫dos (Content e Part)
from datetime import date
import textwrap # Para formatar melhor a sa√≠da de texto
from IPython.display import display, Markdown, HTML # Para exibir texto formatado no Colab
import requests # Para fazer requisi√ß√µes HTTP
import warnings

warnings.filterwarnings("ignore")

# Fun√ß√£o auxiliar que envia uma mensagem para um agente via Runner e retorna a resposta final
def call_agent(agent: Agent, message_text: str) -> str:
    # Cria um servi√ßo de sess√£o em mem√≥ria
    session_service = InMemorySessionService()
    # Cria uma nova sess√£o (voc√™ pode personalizar os IDs conforme necess√°rio)
    session = session_service.create_session(app_name=agent.name, user_id="user1", session_id="session1")
    # Cria um Runner para o agente (orquestrador)
    runner = Runner(agent=agent, app_name=agent.name, session_service=session_service)
    # Cria o conte√∫do da mensagem de entrada
    content = types.Content(role="user", parts=[types.Part(text=message_text)])

    final_response = ""
    # Itera assincronamente pelos eventos retornados durante a execu√ß√£o do agente
    for event in runner.run(user_id="user1", session_id="session1", new_message=content):
        if event.is_final_response():
          for part in event.content.parts:
            if part.text is not None:
              final_response += part.text
              final_response += "\n"
    return final_response

# Fun√ß√£o auxiliar para exibir texto formatado em Markdown no Colab
def to_markdown(text):
  text = text.replace('‚Ä¢', '  *')
  return Markdown(textwrap.indent(text, '> ', predicate=lambda _: True))

######################################################
# --- Obtendo o contexto
######################################################
def obter_contexto():
    localizacao = ""
    periodo = ""
    acompanhantes = ""
    idade = "0"

    print(Markdown(f"***********   IMPORTANTE   ***********\nPara encerrar este agente a qualquer momento, digite no campo de resposta **fim**\n\n\n"))

    while localizacao != "fim":
        localizacao = input("Pergunta 01 de 10 ‚ùì Me informe a sua lozaliza√ß√£o (cidade e estado): ")
        if not localizacao:
            print("\nSaber sua localiza√ß√£o √© muito importante para eu buscar atividade que sejam relevantes para voc√™...\n\n")
        else:
            if localizacao == "fim":
                return localizacao, periodo, acompanhantes, idade
            else:
                print(f"\n√ìtimo! Ent√£o voc√™ procura alguma atividade em {localizacao}...\n")
                break

    while periodo != "fim":
        periodo = input("Pergunta 02 de 10 ‚ùì Agora me diga em qual per√≠odo voc√™ tem maior interesse (Ex.: manh√£,\n tarde, noite, s√°bado a tarde, domingo em qualquer hor√°rio, etc.): ")
        if not periodo:
            print("\nVoc√™ n√£o me informou um per√≠odo, vou assumir que posso buscar em qualquer dia ou hor√°rio, ok?\n\n")
            periodo = "Qualquer dia e hor√°rio" # Valor default
            break
        else:
            if periodo == "fim":
                return localizacao, periodo, acompanhantes, idade
            else:
                print(f"\nEntendi! Prefere que seja {periodo}\n")
                break


    while acompanhantes != "fim":
        acompanhantes = input("Pergunta 03 de 10 ‚ùì Quem ir√° com voc√™ (ex.: vou sozinho(a), com um grupo de amigos, com meu amor,\n com a fam√≠lia e crian√ßas ‚Äì se sim, qual a faixa et√°ria delas?): ")

        if acompanhantes == "":
            print("\nVoc√™ n√£o me informou quem ir√° com voc√™, vou assumir que voc√™ ir√° sozinho(a), ok?\n\n")
        else:
            if acompanhantes == "fim":
                return localizacao, periodo, acompanhantes, idade
            else:
                if acompanhantes.find("sozinh",1) > 0:
                    quem = "voc√™"
                else:
                    quem = "voc√™s"
                print(f"\nExcelente! Vou procurar √≥timas op√ß√µes em {localizacao} para {quem}\n" )
                break


    while idade != "fim":
        idade = input("Pergunta 04 de 10 ‚ùì Me informe por favor a sua idade: ")
        if idade == "0":
            print("\nVoc√™ n√£o me informou sua idade, essa informa√ß√£o me ajudar√° muito na busca de atividades interessantes para voc√™...\n\n")
        else:
            if idade == "fim":
                return localizacao, periodo, acompanhantes, idade
            else:
                if acompanhantes.find("sozinh",1) > 0:
                    quem = "voc√™"
                else:
                    quem = "voc√™s"
                print(f"\n\nObrigado por essas primeiras informa√ß√µes! Agora vou querer saber um pouco mais dos seus interesses...\n\n" )
                break

    #return 'Localiza√ß√£o: \n   - ' + localizacao + '\nPer√≠odo: \n   - ' + periodo + '\nAcompanhantes:   - ' + acompanhantes + '\nIdade: \n   - ' + idade
    return localizacao, periodo, acompanhantes, idade

######################################################
# --- Obtendo os gostos e o "mood"
######################################################

def obter_gostos():
    interesse = ""
    vibe = ""
    evitar = ""

    while interesse != "fim":
        interesse = input("Pergunta 05 de 10 ‚ùì Para que tipo de programa voc√™ est√° mais inclinado(a) (ex.: gastronomia, cultura, ao ar livre, esportes, \n" +
                          "vida noturna, bem-estar e relaxamento, compras ou algo totalmente diferente ou inusitado que voc√™ sempre quis experimentar?): ")
        if not interesse or interesse == "":
            print("\nO seu interesse √© important√≠ssimo para eu buscar atividade que sejam relevantes para voc√™...\n\n")
        else:
            if interesse == "fim":
                return interesse, vibe, evitar
            else:
                print(f"\n√ìtima escolha! Vou seguir observando seu interesse em {interesse}...\n")
                break


    while vibe != "fim":
        vibe = input("Pergunta 06 de 10 ‚ùì Qual a 'vibe' que voc√™ procura para este final de semana? Algo mais agitado e social, super tranquilo\n" +
                     "e relaxante, culturalmente enriquecedor, cheio de aventura, rom√¢ntico, ou talvez uma mistura?: ")
        if not vibe or vibe == "":
            print("\nO seu interesse √© important√≠ssimo para eu buscar atividade que sejam relevantes para voc√™...\n\n")
        else:
            if vibe == "fim":
                return interesse, vibe, evitar
            else:
                print(f"\nEntendi, j√° estou imaginando nessa vibe {vibe}...\n")
                break


    while evitar != "fim":
        evitar = input("Pergunta 07 de 10 ‚ùì Existe algum tipo de programa ou atividade que voc√™ gostaria de *evitar* a todo custo?: ")

        if not evitar or evitar == "":
            print("\Entendendo que voc√™ n√£o tem nenhuma restri√ß√£o e seguirei assim, ok?\n\n")
            evitar = "N√£o tenho nenhuma restri√ß√£o"
            break
        else:
            if evitar == "fim":
                return interesse, vibe, evitar
            else:
                print(f"\nPode deixar que vou evitar {evitar}...\n")
                break

    print(f"\n\nChegamos num ponto muito importante, agora vamos falar de detalhes pr√°ticos para a escolha\n")

    #return 'Interesse: \n   - ' + interesse + '\nVibe: \n   - ' + vibe + '\nEvitar:   - ' + evitar
    return interesse, vibe, evitar

######################################################
# --- Obtendo detalhes pr√°ticos
######################################################

def obter_detalhes():
    investimento = ""
    distancia = ""
    curiosidade = ""

    while investimento != "fim":
        investimento = input("Pergunta 08 de 10 ‚ùì Falando de investimento, voc√™ tem uma faixa de or√ßamento em mente para essas atividades? (ex: busco op√ß√µes gratuitas,\n" +
                             "algo mais em conta at√© R$ X por pessoa, posso gastar um pouco mais, ou o c√©u √© o limite?): ")
        if not investimento:
            print("\Xiiiii... Me ajuda a√≠ vai? Esse √© um par√¢metro importante para minhas decis√µes do que lhe oferecer de op√ß√£o.\n\n")
        else:
            if investimento == "fim":
                return investimento, distancia, curiosidade
            else:
                print(f"\nMaravilha! N√£o vou esquecer de levar isso em considera√ß√£o...\n")
                break


    while distancia != "fim":
        distancia = input("Pergunta 09 de 10 ‚ùì At√© que dist√¢ncia voc√™ toparia se deslocar a partir do seu ponto principal (casa/hotel) para encontrar a atividade ideal?: ")
        if not distancia:
            print("\nVou considerar que s√≥ deseja algo na pr√≥pria cidade, ok?.\n\n")
            distancia = "Somente aqui na cidade"
            break
        else:
            if distancia == "fim":
                return investimento, distancia, curiosidade
            else:
                print(f"\nVamos ver o que eu encontrarei nessa dist√¢ncia...\n")
                break


    while curiosidade != "fim":
        curiosidade = input("Pergunta 10 de 10 ‚ùì Voc√™ j√° tem alguma ideia guardada na manga, algum lugar que sempre quis conhecer ou algo que viu e ficou curioso(a)?: ")
        if not curiosidade:
            print("\nVou considerar que s√≥ deseja algo na pr√≥pria cidade, ok?.\n\n")
            curiosidade = "N√£o tenho nenhuma ideia"
            break
        else:
            if curiosidade == "fim":
                return investimento, distancia, curiosidade
            else:
                print(f"\nIsso vai me ajudar a identificar melhor algusn dos seus interesses...\n")
                break


    #return 'Investimento: \n   - ' + investimento + '\nDist√¢ncia M√°xima: \n   - ' + distancia + '\nTenho Curiosidade Por:   - ' + curiosidade
    return investimento, distancia, curiosidade

################################################
# --- Agente: Buscador de Entretenimento   --- #
################################################
def agente_buscador(data_de_hoje, infos_do_cliente):
    instrucao = f"""Voc√™ √© um Assistente de Entretenimento.
        Seu objetivo √© montar um roteiro de programas e atividades
        para a pr√≥xima semana a partir da data de hoje utilizando ferramenta de busca do Google (google_search)
        e tamb√©m sua base de dados local, levando em conta os seguintes par√¢metros do cliente:
            1. Localiza√ß√£o atual:
                - Cidade, bairro ou regi√£o de onde o cliente partir√°
            2. Per√≠odo(s) do dia de interesse:
                - (ex.: manh√£, tarde, noite, qualquer hor√°rio)
            3. Acompanhantes:
                - Quem ir√° junto (ex.: fam√≠lia, amigos, crian√ßas) e idades de cada pessoa.
            4. Tipos de programas/atividades de interesse:
                - (ex.: passeios ao ar livre, exposi√ß√µes, shows, aulas, tours guiados).
            5. Categorias preferidas:
                - (ex.: gastronomia, cultura, esportes, bem-estar, vida noturna).
            6. Atividades a evitar:
                - (ex.: lugares muito barulhentos, ambientes fechados, trilhas dif√≠ceis).
            7. Or√ßamento por pessoa:
                - Valor m√°ximo estimado (ex.: at√© R$ 100, R$ 200‚Äì300).
            8. Dist√¢ncia m√°xima de deslocamento:
                - Raio de viagem a partir da localiza√ß√£o (em km ou tempo de deslocamento).
            9. Pontos de curiosidade:
                - Lugares espec√≠ficos que o cliente j√° demonstrou interesse em conhecer.

        **Instru√ß√µes de Execu√ß√£o:**
        - Para cada dia da pr√≥xima semana, sugira **2 a 5 op√ß√µes** de programa, cobrindo o(s) per√≠odo(s) de interesse.
        - Considere nas op√ß√µes selecionadas o entusiasmo das not√≠cias sobre ele.
        - Se um dos lan√ßamentos encontrados tiver poucas not√≠cias ou poucas rea√ß√µes entusiasmadas, √© poss√≠vel que ele n√£o seja t√£o relevante e pode ser substitu√≠do por outro que tenha mais.
        - Informe t√≠tulo do programa, breve descri√ß√£o (1‚Äì2 frases), custo aproximado por pessoa, endere√ßo/localiza√ß√£o e link oficial ou site para reserva/ingressos.
        - Caso haja op√ß√£o gratuita, destaque-a como ‚ÄúGratuito‚Äù.
        - Se alguma atividade exigir reserva antecipada, mencione o prazo m√≠nimo.
        - Verifique disponibilidade ou hor√°rios atualizados (datas e hor√°rios exatos).
        - Agrupe as sugest√µes por dia e per√≠odo, por exemplo:

            **Segunda-feira (Manh√£)**
            1. Passeio no Parque X ‚Äì descri√ß√£o‚Ä¶
            2. Oficina de Cer√¢mica no Ateli√™ Y ‚Äì descri√ß√£o‚Ä¶

            **Segunda-feira (Tarde)**
            1. ‚Ä¶

        - Ao final, inclua um breve comparativo entre as op√ß√µes (pr√≥s e contras) para ajudar o cliente na escolha.

        **Exemplo de Uso**:

        Informa√ß√µes do cliente:
        - Localiza√ß√£o: S√£o Paulo, Vila Madalena
        - Per√≠odo: Tarde e noite
        - Acompanhantes: Casal (30 e 28 anos)
        - Interesses: Gastronomia, cultura, vida noturna
        - Evitar: Baladas com som muito alto
        - Or√ßamento: at√© R$ 200 por pessoa
        - Dist√¢ncia: at√© 10 km
        - Curiosidade: Quer conhecer o novo bar tem√°tico Z

        *Gere um roteiro de segunda-feira a domingo com base nesses dados.*"""


    buscador = Agent(
        name="agente_buscador",
        model="gemini-2.0-flash",
        # Inserir as instru√ß√µes do Agente Buscador #################################################
        tools=[google_search],
        description="Agente que busca op√ß√µes de programas ou atividades de acordo com o perfil informado pelo cliente",
        instruction=instrucao
    )

    entrada_do_agente_buscador = f"Data de hoje: {data_de_hoje}\nInforma√ß√µes do cliente: {infos_do_cliente}"

    # Executa o agente
    atividades_encontradas = call_agent(buscador, entrada_do_agente_buscador)
    return atividades_encontradas

################################################
# --- Agente: Diagramador                  --- #
################################################
def agente_diagramador(conteudo):
    redator = Agent(
        name="agente_diagramador",
        #model="gemini-2.5-pro-preview-03-25",
        #model = "gemini-2.0-pro-exp",
        #model = "gemini-1.5-pro-latest",
        model="gemini-2.0-flash",
        tools=[google_search],

        instruction="""
            Voc√™ √© um Editor e diagramador experiente e criativo, com grande conhecimento em escrita de c√≥digo HTML.
            Voc√™ √© acostumado a escrever e diagramar muitos conte√∫dos de entretenimento para os mais diversos p√∫blicos.
            Utilize o conteudo fornecido, reorganize e enrique√ßa-os com cita√ß√µes e links de reportagens que voc√™ pode obter
            atrav√©s de pesquisa no Google Search (google_search), para criar uma p√°gina HTML atrativa e elegante, com uma
            paleta de cores em tons past√©is que divulgar√° as sugest√µes de divers√£o para o p√∫blico.
            """,
        description="Agente diagramador de conte√∫dos em formato HTML"
    )
    entrada_do_agente_redator = f"Conte√∫do: {conteudo}"
    # Executa o agente
    texto = call_agent(redator, entrada_do_agente_redator)
    return texto

# Lista os modelos de IA dispon√≠veis
client = genai.Client()
for model in client.models.list():
  print(model)

def executa_agentes():
    data_de_hoje = date.today().strftime("%d/%m/%Y")

    print("\n\n*******üöÄ Iniciando o Agente Pura Divers√£o!!! üöÄ*******\n\n\n")

    (localizacao, periodo, acompanhantes, idade) = obter_contexto()
    if localizacao == "fim" or periodo == "fim" or acompanhantes == "fim" or idade == "fim":
        return "fim"

    (interesse, vibe, evitar) = obter_gostos()
    if interesse == "fim" or vibe == "fim" or evitar == "fim":
        return "fim"

    (investimento, distancia, curiosidade) = obter_detalhes()

    if investimento == "fim" or distancia == "fim" or curiosidade == "fim":
        return "fim"

    print("\n\n\n******************************************* Iniciando a busca das melhores op√ß√ß√µes para voc√™... *************************************************\n\n\n")
    infos_do_cliente = f"""- Localiza√ß√£o: {localizacao}\n- Per√≠odo: {periodo}\n- Acompanhantes: {acompanhantes} e eu tenho {idade}\n
                   - Interesses: {interesse}, com uma vibe {vibe}\n - Evitar: {evitar}\n- Or√ßamento: {investimento}\n
                   - Dist√¢ncia: {distancia}\n- Curiosidades: {curiosidade}"""

    resultado = agente_buscador(data_de_hoje, infos_do_cliente)

    return resultado

def apresenta_resultado(resultado):
    texto = agente_diagramador(resultado)
    print("\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n")

    #print("\n************************************************************ T√° aqui as nossas recomenda√ß√µes para voc√™ ************************************************************\n")
    display(HTML(texto))

resultado = executa_agentes()

if resultado != "fim":
    apresenta_resultado(resultado)
else:
    display(HTML("At√© a pr√≥xima..."))